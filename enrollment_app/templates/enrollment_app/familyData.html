{% load static %}
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Pre-Enrollment Form - Family Data</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600;700&family=Inter:wght@400;500;600&display=swap"
      rel="stylesheet"
    />

    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              primary: "#991b1b",
              "primary-dark": "#7f1d1d",
            },
            fontFamily: {
              sans: ["Inter", "sans-serif"],
              display: ["Playfair Display", "serif"],
            },
          },
        },
      };
    </script>

    <style>
      body {
        font-family: "Inter", sans-serif;
      }

      h1,
      h2,
      h3,
      h4,
      .section-title {
        font-family: "Playfair Display", serif;
      }

      .form-container {
        background: linear-gradient(135deg, #f9fafb 0%, #f3f4f6 100%);
        min-height: 100vh;
      }

      input:focus,
      select:focus,
      textarea:focus {
        outline: none;
        border-color: #991b1b !important;
        box-shadow: 0 0 0 3px rgba(153, 27, 27, 0.1);
      }

      .field-error {
        border-color: #dc2626 !important;
        background-color: #fef2f2 !important;
      }

      .age-display {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        padding: 0.5rem 0.75rem;
        background-color: #f3f4f6;
        border: 1px solid #e5e7eb;
        border-radius: 0.375rem;
        font-size: 0.9rem;
        color: #4b5563;
        font-weight: 500;
        white-space: nowrap;
        min-width: 90px;
      }

      .radio-option {
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .radio-option input[type="radio"]:checked + label {
        background-color: #991b1b;
        color: white;
        border-color: #991b1b;
      }

      .radio-option label {
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 0.75rem 1.5rem;
        border: 2px solid #d1d5db;
        border-radius: 0.5rem;
        font-weight: 600;
        transition: all 0.3s ease;
      }

      .radio-option label:hover {
        border-color: #991b1b;
        background-color: #fef2f2;
      }

      .guardian-fields-container {
        transition: all 0.3s ease;
      }
    </style>
  </head>

  <body class="form-container">
    <!-- Header -->
    <header
      class="bg-white border-b-2 border-gray-300 sticky top-0 z-50 shadow-sm"
    >
      <div class="max-w-7xl mx-auto px-4 py-4 sm:px-6 lg:px-8">
        <div class="flex justify-between items-center flex-wrap gap-4">
          <div class="flex items-center gap-4">
            <img
              src="{% static 'images/westLogo.png' %}"
              alt="School Logo"
              class="h-16 w-auto"
            />
            <div class="text-sm sm:text-base">
              <h1 class="text-xl sm:text-2xl font-bold text-red-900">
                Zamboanga National High School West
              </h1>
              <p class="text-gray-600">
                R.T. Lim Boulevard Zamboanga City, Philippines
              </p>
              <p class="text-gray-600 text-sm">School I.D: 303942</p>
            </div>
          </div>
        </div>
      </div>
    </header>

    <!-- NAVIGATION STEPS -->
    <div class="bg-gray-200 py-3">
      <div class="max-w-5xl mx-auto flex gap-4 px-4">
        <div class="px-4 py-2 bg-primary text-white rounded-lg font-semibold">
          Step 1: Enrollment
        </div>
        <div
          class="px-4 py-2 bg-gray-400 text-gray-900 rounded-lg font-semibold"
        >
          Step 2: Section Placement
        </div>
      </div>
    </div>

    <main class="max-w-5xl mx-auto px-4 py-8 sm:px-6 lg:px-8">
      <!-- Title -->
      <div
        class="bg-white rounded-lg shadow-md p-6 sm:p-8 mb-6 text-center border-t-4 border-red-900"
      >
        <h2 class="text-3xl sm:text-4xl font-bold text-red-900 mb-2">
          FAMILY DATA
        </h2>
        <p class="text-base sm:text-lg text-gray-700">School Year {% if school_year %}{{ school_year.year_label }}{% else %}Not Set{% endif %}</p>
      </div>

      {% if messages %}
      <div class="mb-6">
        {% for message in messages %}
        <div
          class="{% if message.tags == 'error' %}bg-red-100 border-l-4 border-red-500 text-red-700{% else %}bg-green-100 border-l-4 border-green-500 text-green-700{% endif %} p-4 rounded-lg animate-slide-down"
          role="alert"
        >
          <div class="flex items-center">
            <i
              class="fas {% if message.tags == 'error' %}fa-exclamation-circle{% else %}fa-check-circle{% endif %} mr-3 text-xl"
            ></i>
            <p class="font-semibold">{{ message }}</p>
          </div>
        </div>
        {% endfor %}
      </div>
      {% endif %}

      <!-- Student Banner -->
      <div class="bg-blue-50 border-l-4 border-blue-500 p-4 mb-6 rounded">
        {% if student_info %}
        <h4 class="text-gray-700 font-semibold text-base">
          Student: {{ student_info.first_name }} {{ student_info.last_name }}
          (LRN: {{ student_info.lrn }})
        </h4>
        {% else %}
        <h4 class="text-gray-700 font-semibold text-base">
          Student Information
        </h4>
        {% endif %}
      </div>

      <!-- START OF FORM -->
      <form
        method="POST"
        action="{% url 'enrollment_app:family_data' %}"
        enctype="multipart/form-data"
        id="familyDataForm"
        novalidate
      >
        {% csrf_token %}

        <div class="grid grid-cols-1 lg:grid-cols-4 gap-6 mb-6">
          <!-- Left Side: Family Info -->
          <div class="lg:col-span-3">
            <div
              class="bg-white rounded-lg shadow-md p-6 sm:p-8 border-2 border-gray-200"
            >
              <h3 class="text-2xl font-bold text-red-900 mb-2">
                B. Family Information Data
                <span class="text-sm font-normal text-gray-600 block mt-1">
                  (Please fill in the complete and correct details)
                </span>
              </h3>

              <!-- Father's Info -->
              <div
                class="mt-8 p-6 bg-gray-50 rounded-lg border border-gray-200"
              >
                <h4 class="text-lg font-bold text-red-900 mb-6">
                  FATHER'S INFORMATION:
                </h4>

                <div class="space-y-6">
                  <!-- Name -->
                  <div>
                    <label
                      class="block text-sm font-semibold text-gray-800 mb-3"
                      >NAME: <span class="text-red-600">*</span></label
                    >
                    <div class="grid grid-cols-3 gap-3">
                      <input
                        type="text"
                        name="father_family_name"
                        placeholder="Last Name"
                        required
                        value="{{ form_data.father_family_name|default:'' }}"
                        class="border-2 border-gray-300 rounded-lg px-4 py-2"
                      />
                      <input
                        type="text"
                        name="father_first_name"
                        placeholder="First Name"
                        required
                        value="{{ form_data.father_first_name|default:'' }}"
                        class="border-2 border-gray-300 rounded-lg px-4 py-2"
                      />
                      <input
                        type="text"
                        name="father_middle_name"
                        placeholder="Middle Name"
                        value="{{ form_data.father_middle_name|default:'' }}"
                        class="border-2 border-gray-300 rounded-lg px-4 py-2"
                      />
                    </div>
                  </div>

                  <!-- DOB + Age -->
                  <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                    <div>
                      <label
                        class="block text-sm font-semibold text-gray-800 mb-2"
                        >Date of Birth:
                        <span class="text-red-600">*</span></label
                      >
                      <div class="flex gap-2 items-center">
                        <input
                          type="date"
                          name="father_dob"
                          required
                          value="{{ form_data.father_dob|default:'' }}"
                          class="border-2 border-gray-300 rounded-lg px-4 py-2 w-full"
                        />
                        <span class="age-display" id="father-age-display"
                          >Age: --</span
                        >
                      </div>
                    </div>

                    <div>
                      <label
                        class="block text-sm font-semibold text-gray-800 mb-2"
                        >Occupation: <span class="text-red-600">*</span></label
                      >
                      <input
                        type="text"
                        name="father_occupation"
                        required
                        value="{{ form_data.father_occupation|default:'' }}"
                        class="border-2 border-gray-300 rounded-lg px-4 py-2 w-full"
                      />
                    </div>
                  </div>

                  <!-- Complete Address -->
                  <div>
                    <label
                      class="block text-sm font-semibold text-gray-800 mb-2"
                      >Complete Home Address:</label
                    >
                    <input
                      type="text"
                      name="father_address"
                      value="{{ form_data.father_address|default:'' }}"
                      class="border-2 border-gray-300 rounded-lg px-4 py-2 w-full"
                    />
                  </div>

                  <!-- Contact + Email -->
                  <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                    <div>
                      <label
                        class="block text-sm font-semibold text-gray-800 mb-2"
                        >Contact Number:
                        <span class="text-red-600">*</span></label
                      >
                      <input
                        type="tel"
                        name="father_contact_number"
                        required
                        value="{{ form_data.father_contact_number|default:'' }}"
                        class="border-2 border-gray-300 rounded-lg px-4 py-2 w-full"
                      />
                    </div>
                    <div>
                      <label
                        class="block text-sm font-semibold text-gray-800 mb-2"
                        >Email Address:</label
                      >
                      <input
                        type="email"
                        name="father_email"
                        value="{{ form_data.father_email|default:'' }}"
                        class="border-2 border-gray-300 rounded-lg px-4 py-2 w-full"
                      />
                    </div>
                  </div>
                </div>
              </div>

              <!-- Mother's Info -->
              <div
                class="mt-8 p-6 bg-gray-50 rounded-lg border border-gray-200"
              >
                <h4 class="text-lg font-bold text-red-900 mb-6">
                  MOTHER'S INFORMATION:
                </h4>

                <div class="space-y-6">
                  <!-- Name -->
                  <div>
                    <label
                      class="block text-sm font-semibold text-gray-800 mb-3"
                      >NAME: <span class="text-red-600">*</span></label
                    >
                    <div class="grid grid-cols-3 gap-3">
                      <input
                        type="text"
                        name="mother_family_name"
                        placeholder="Last Name"
                        required
                        value="{{ form_data.mother_family_name|default:'' }}"
                        class="border-2 border-gray-300 rounded-lg px-4 py-2"
                      />
                      <input
                        type="text"
                        name="mother_first_name"
                        placeholder="First Name"
                        required
                        value="{{ form_data.mother_first_name|default:'' }}"
                        class="border-2 border-gray-300 rounded-lg px-4 py-2"
                      />
                      <input
                        type="text"
                        name="mother_middle_name"
                        placeholder="Middle Name"
                        value="{{ form_data.mother_middle_name|default:'' }}"
                        class="border-2 border-gray-300 rounded-lg px-4 py-2"
                      />
                    </div>
                  </div>

                  <!-- DOB + Age -->
                  <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                    <div>
                      <label
                        class="block text-sm font-semibold text-gray-800 mb-2"
                        >Date of Birth:
                        <span class="text-red-600">*</span></label
                      >
                      <div class="flex gap-2 items-center">
                        <input
                          type="date"
                          name="mother_dob"
                          required
                          value="{{ form_data.mother_dob|default:'' }}"
                          class="border-2 border-gray-300 rounded-lg px-4 py-2 w-full"
                        />
                        <span class="age-display" id="mother-age-display"
                          >Age: --</span
                        >
                      </div>
                    </div>

                    <div>
                      <label
                        class="block text-sm font-semibold text-gray-800 mb-2"
                        >Occupation: <span class="text-red-600">*</span></label
                      >
                      <input
                        type="text"
                        name="mother_occupation"
                        required
                        value="{{ form_data.mother_occupation|default:'' }}"
                        class="border-2 border-gray-300 rounded-lg px-4 py-2 w-full"
                      />
                    </div>
                  </div>

                  <!-- Complete Address -->
                  <div>
                    <label
                      class="block text-sm font-semibold text-gray-800 mb-2"
                      >Complete Home Address:</label
                    >
                    <input
                      type="text"
                      name="mother_address"
                      value="{{ form_data.mother_address|default:'' }}"
                      class="border-2 border-gray-300 rounded-lg px-4 py-2 w-full"
                    />
                  </div>

                  <!-- Contact + Email -->
                  <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                    <div>
                      <label
                        class="block text-sm font-semibold text-gray-800 mb-2"
                        >Contact Number:
                        <span class="text-red-600">*</span></label
                      >
                      <input
                        type="tel"
                        name="mother_contact_number"
                        required
                        value="{{ form_data.mother_contact_number|default:'' }}"
                        class="border-2 border-gray-300 rounded-lg px-4 py-2 w-full"
                      />
                    </div>
                    <div>
                      <label
                        class="block text-sm font-semibold text-gray-800 mb-2"
                        >Email Address:</label
                      >
                      <input
                        type="email"
                        name="mother_email"
                        value="{{ form_data.mother_email|default:'' }}"
                        class="border-2 border-gray-300 rounded-lg px-4 py-2 w-full"
                      />
                    </div>
                  </div>
                </div>
              </div>

              <!-- Official Guardian Selection -->
              <div
                class="mt-8 p-6 bg-blue-50 rounded-lg border-2 border-blue-300"
              >
                <h4
                  class="text-lg font-bold text-red-900 mb-4 flex items-center gap-2"
                >
                  <i class="fas fa-user-shield text-blue-600"></i>
                  WHO IS THE STUDENT'S OFFICIAL GUARDIAN?
                  <span class="text-red-600">*</span>
                </h4>
                <p class="text-sm text-gray-600 mb-4">
                  Select who will be responsible for the student during their
                  enrollment
                </p>

                <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
                  <div class="radio-option">
                    <input type="radio" name="guardian_type"
                    id="guardian_father" value="father" {% if form_data.guardian_type == 'father' %}checked{% endif %}class="hidden" required>
                    
                    <label for="guardian_father" class="cursor-pointer">
                      <i class="fas fa-male mr-2"></i>
                      Father
                    </label>
                  </div>

                  <div class="radio-option">
                    <input type="radio" name="guardian_type"
                    id="guardian_mother" value="mother" {% if form_data.guardian_type == 'mother' %}checked{% endif %} class="hidden">
                    
                    <label for="guardian_mother" class="cursor-pointer">
                      <i class="fas fa-female mr-2"></i>
                      Mother
                    </label>
                  </div>

                  <div class="radio-option">
                    <input type="radio" name="guardian_type" id="guardian_other"
                    value="other" {% if form_data.guardian_type == 'other' %}checked{% endif %} class="hidden">
                    <label for="guardian_other" class="cursor-pointer">
                      <i class="fas fa-user-friends mr-2"></i>
                      Other Guardian
                    </label>
                  </div>
                </div>
              </div>

              <!-- Guardian Info (Only shown when "Other Guardian" is selected) -->
              <div
                id="guardian-fields"
                class="mt-6 p-6 bg-gray-50 rounded-lg border border-gray-200 guardian-fields-container hidden"
              >
                <h4 class="text-lg font-bold text-red-900 mb-6">
                  OTHER GUARDIAN INFORMATION:
                  <span class="text-sm font-normal text-gray-600"
                    >(Please provide complete details)</span
                  >
                </h4>
                <div class="space-y-4">
                  <div>
                    <label
                      class="block text-sm font-semibold text-gray-800 mb-3"
                      >NAME: <span class="text-red-600">*</span></label
                    >
                    <div class="grid grid-cols-3 gap-3">
                      <input
                        type="text"
                        name="guardian_family_name"
                        id="guardian_family_name"
                        placeholder="Last Name"
                        value="{{ form_data.guardian_family_name|default:'' }}"
                        class="border-2 border-gray-300 rounded-lg px-4 py-2 w-full focus:border-red-900"
                      />
                      <input
                        type="text"
                        name="guardian_first_name"
                        id="guardian_first_name"
                        placeholder="First Name"
                        value="{{ form_data.guardian_first_name|default:'' }}"
                        class="border-2 border-gray-300 rounded-lg px-4 py-2 w-full focus:border-red-900"
                      />
                      <input
                        type="text"
                        name="guardian_middle_name"
                        id="guardian_middle_name"
                        placeholder="Middle Name"
                        value="{{ form_data.guardian_middle_name|default:'' }}"
                        class="border-2 border-gray-300 rounded-lg px-4 py-2 w-full focus:border-red-900"
                      />
                    </div>
                  </div>
                  <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                    <div>
                      <label
                        class="block text-sm font-semibold text-gray-800 mb-2"
                        >Date of Birth:
                        <span class="text-red-600">*</span></label
                      >
                      <div class="flex gap-2 items-center">
                        <input
                          type="date"
                          name="guardian_dob"
                          id="guardian_dob"
                          value="{{ form_data.guardian_dob|default:'' }}"
                          class="border-2 border-gray-300 rounded-lg px-4 py-2 w-full focus:border-red-900"
                        />
                        <span class="age-display" id="guardian-age-display"
                          >Age: --</span
                        >
                      </div>
                    </div>
                    <div>
                      <label
                        class="block text-sm font-semibold text-gray-800 mb-2"
                        >Occupation: <span class="text-red-600">*</span></label
                      >
                      <input
                        type="text"
                        name="guardian_occupation"
                        id="guardian_occupation"
                        value="{{ form_data.guardian_occupation|default:'' }}"
                        class="border-2 border-gray-300 rounded-lg px-4 py-2 w-full focus:border-red-900"
                      />
                    </div>
                  </div>
                  <div>
                    <label
                      class="block text-sm font-semibold text-gray-800 mb-2"
                      >Complete Home Address:
                      <span class="text-red-600">*</span></label
                    >
                    <input
                      type="text"
                      name="guardian_address"
                      id="guardian_address"
                      value="{{ form_data.guardian_address|default:'' }}"
                      class="border-2 border-gray-300 rounded-lg px-4 py-2 w-full focus:border-red-900"
                    />
                  </div>
                  <div>
                    <label
                      class="block text-sm font-semibold text-gray-800 mb-2"
                      >Relationship with the student:
                      <span class="text-red-600">*</span></label
                    >
                    <input
                      type="text"
                      name="guardian_relationship"
                      id="guardian_relationship"
                      placeholder="e.g., Grandmother, Uncle, Aunt"
                      value="{{ form_data.guardian_relationship|default:'' }}"
                      class="border-2 border-gray-300 rounded-lg px-4 py-2 w-full focus:border-red-900"
                    />
                  </div>
                  <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                    <div>
                      <label
                        class="block text-sm font-semibold text-gray-800 mb-2"
                        >Contact Number:
                        <span class="text-red-600">*</span></label
                      >
                      <input
                        type="tel"
                        name="guardian_contact_number"
                        id="guardian_contact_number"
                        value="{{ form_data.guardian_contact_number|default:'' }}"
                        class="border-2 border-gray-300 rounded-lg px-4 py-2 w-full focus:border-red-900"
                      />
                    </div>
                    <div>
                      <label
                        class="block text-sm font-semibold text-gray-800 mb-2"
                        >Email Address:</label
                      >
                      <input
                        type="email"
                        name="guardian_email"
                        id="guardian_email"
                        value="{{ form_data.guardian_email|default:'' }}"
                        class="border-2 border-gray-300 rounded-lg px-4 py-2 w-full focus:border-red-900"
                      />
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Right Side: Parent Photo Upload (Replace the existing photo upload section) -->
          <div class="lg:col-span-1">
            <div
              class="sticky top-24 bg-white rounded-lg shadow-md p-6 border-2 border-gray-200"
            >
              <p class="text-center font-semibold text-gray-800 mb-4">
                UPLOAD PARENT 1x1 PICTURE <span class="text-red-600">*</span>
              </p>

              <label
                for="parent_photo"
                class="block w-full aspect-square border-2 border-dashed border-gray-300 rounded-lg cursor-pointer hover:border-red-900 hover:bg-red-50 transition-all flex items-center justify-center relative overflow-hidden"
              >
                <div class="upload-icon-container text-red-900 text-5xl {% if form_data.parent_photo_path %}hidden{% endif %}">
                  <i class="fas fa-cloud-upload-alt"></i>
                </div>

                {% if form_data.parent_photo_path %}
                  {% load static %}
                  <img
                    id="parent-photo-preview"
                    src="{% url 'enrollment_app:serve_temp_image' form_data.parent_photo_path|slice:'-36:' %}"
                    alt="Preview"
                    class="max-w-full max-h-full object-cover rounded-lg"
                  />
                {% else %}
                  <img
                    id="parent-photo-preview"
                    src="#"
                    alt="Preview"
                    class="hidden max-w-full max-h-full object-cover rounded-lg"
                  />
                {% endif %}

                {% if form_data.parent_photo_name %}
                <div class="absolute bottom-2 left-2 bg-black bg-opacity-50 text-white text-xs px-2 py-1 rounded">
                  {{ form_data.parent_photo_name }}
                </div>
                {% endif %}

                <input
                  type="file"
                  id="parent_photo"
                  name="parent_photo"
                  accept="image/*"
                  {% if not form_data.parent_photo_path %}required{% endif %}
                  class="hidden"
                />
              </label>
              <p class="mt-3 text-xs text-gray-600 text-center">
                Click to upload
              </p>
            </div>
          </div>

        <!-- Buttons -->
        <div class="flex justify-center gap-6 mt-10 pb-10">
          <a
            href="{% url 'enrollment_app:student_data' %}"
            class="px-8 py-3 bg-gray-600 hover:bg-gray-700 text-white font-semibold rounded-lg transition-all flex items-center gap-2 shadow-md"
          >
            <i class="fas fa-arrow-left mr-1"></i>
            Back
          </a>
          <button
            type="submit"
            class="px-8 py-3 bg-red-900 hover:bg-red-950 text-white font-semibold rounded-lg transition-all shadow-md flex items-center gap-2"
          >
            Next
            <i class="fas fa-arrow-right ml-1"></i>
          </button>
        </div>
      </form>
    </main>

    <script>
      // Photo Preview Script
      document
        .getElementById("parent_photo")
        .addEventListener("change", function (e) {
          const file = e.target.files[0];
          if (file) {
            const reader = new FileReader();
            reader.onload = function (e) {
              const preview = document.getElementById("parent-photo-preview");
              preview.src = e.target.result;
              preview.classList.remove("hidden");
              document.querySelector(".upload-icon-container").style.display =
                "none";
            };
            reader.readAsDataURL(file);
          }
        });

      // Age Calculator
      function calculateAge(dobInput, displayId) {
        const dob = new Date(dobInput.value);
        if (!isNaN(dob)) {
          const today = new Date();
          let age = today.getFullYear() - dob.getFullYear();
          const m = today.getMonth() - dob.getMonth();
          if (m < 0 || (m === 0 && today.getDate() < dob.getDate())) age--;
          document.getElementById(displayId).textContent = `Age: ${age}`;
        }
      }

      // Check if guardian type "other" was previously selected
      document.addEventListener("DOMContentLoaded", function () {
        const guardianOtherRadio = document.getElementById("guardian_other");
        if (guardianOtherRadio && guardianOtherRadio.checked) {
          const guardianFields = document.getElementById("guardian-fields");
          const guardianInputs = guardianFields.querySelectorAll("input");

          // Show guardian fields
          guardianFields.classList.remove("hidden");

          // Make fields required
          guardianInputs.forEach((input) => {
            if (
              input.id !== "guardian_email" &&
              input.id !== "guardian_middle_name"
            ) {
              input.setAttribute("required", "required");
            }
          });
        }
      });

      ["father_dob", "mother_dob", "guardian_dob"].forEach((id) => {
        const input = document.querySelector(`input[name="${id}"]`);
        if (input)
          input.addEventListener("change", () =>
            calculateAge(input, id.replace("_dob", "") + "-age-display")
          );
      });

      // Guardian Selection Logic
      const guardianRadios = document.querySelectorAll(
        'input[name="guardian_type"]'
      );
      const guardianFields = document.getElementById("guardian-fields");
      const guardianInputs = guardianFields.querySelectorAll("input");

      guardianRadios.forEach((radio) => {
        radio.addEventListener("change", function () {
          if (this.value === "other") {
            // Show guardian fields
            guardianFields.classList.remove("hidden");
            // Make guardian fields required
            guardianInputs.forEach((input) => {
              if (
                input.id !== "guardian_email" &&
                input.id !== "guardian_middle_name"
              ) {
                input.setAttribute("required", "required");
              }
            });
          } else {
            // Hide guardian fields
            guardianFields.classList.add("hidden");
            // Remove required from guardian fields
            guardianInputs.forEach((input) => {
              input.removeAttribute("required");
              input.value = ""; // Clear values
            });
            // Clear age display
            document.getElementById("guardian-age-display").textContent =
              "Age: --";
          }
        });
      });

      // Form validation before submit
      document
        .getElementById("familyDataForm")
        .addEventListener("submit", function (e) {
          const guardianType = document.querySelector(
            'input[name="guardian_type"]:checked'
          );

          if (!guardianType) {
            e.preventDefault();
            alert("Please select who will be the student's official guardian.");
            return false;
          }

          // If "other" is selected, validate guardian fields
          if (guardianType.value === "other") {
            const requiredFields = [
              "guardian_family_name",
              "guardian_first_name",
              "guardian_dob",
              "guardian_occupation",
              "guardian_address",
              "guardian_relationship",
              "guardian_contact_number",
            ];

            let hasError = false;
            requiredFields.forEach((fieldName) => {
              const field = document.getElementById(fieldName);
              if (!field || !field.value.trim()) {
                hasError = true;
                if (field) field.classList.add("field-error");
              } else {
                if (field) field.classList.remove("field-error");
              }
            });

            if (hasError) {
              e.preventDefault();
              alert("Please fill in all required guardian information fields.");
              return false;
            }
          }
        });
    </script>
  </body>
</html>
